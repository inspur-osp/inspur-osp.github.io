name: Check Download URL

on:
  release:
    types:
      - created

jobs:
  check_url:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get latest release
      id: get_release
      run: |
        releases=$(curl -s "https://api.github.com/repos/latisinspur/latisinspur.github.io/releases")
        latest_tag=$(echo "$releases" | jq -r '.[0].tag_name')
        echo "::set-output name=tag::$latest_tag"
        
    - name: Send Email
      uses: devellany/send-mail@v1.0.2
      with:
        host: smtp.qq.com
        port: 587
        account: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        sender: Miklos Ventura
        from: 846162223@qq.com
        to: me@lhxone.com
        subject: LATIS iOS APP New Version
        body: |
          Dear LATIS Maintainers:

          The Latis iOS App has released a new version.
          URL-> https://github.com/latisinspur/latisinspur.github.io/releases
          Latest Release Tag-> ${{ steps.get_release.outputs.tag }}
          From GitHub Action
